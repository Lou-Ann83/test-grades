---
title: "Toujas-Tort"
format: html
editor: visual
repo-url: https://github.com/Lou-Ann83/test-grades.git
---

## Intro

```{r}
here::i_am("test-grades.Rproj")
library(ggplot2)
library(dplyr)
library(here)
library(vroom)
library(stringr)
library(tidyr)
library(readr)
```

## Question 1

```{r}
courses <- read.csv("data/courses.csv") 
```

## Question 2

```{r}
courses <- courses |> rename(`course name`= course, identifier = course_id, `Number of exams`= nb_grades ) |> arrange((`course name`))

knitr::kable(courses)
```

## Question 3

```{r}
students <- read_delim(here("data", "students.csv"), col_types = cols(group = col_factor(), birth_date= col_date(), sex = col_factor(), id = col_integer()))
str(students)
print("The birth_date column of the students data frame is a Date column ")
```

## Question 4

```{r}
grades <- read_delim(here("data", "grades.csv"), delim = ":", na = "$")
str(grades)
```

## Question 5

```{r}
nb_student_per_grp <- students |> distinct(id, group) |> count(group)
ggplot(nb_student_per_grp, aes(x=n, y=group))+
  geom_col()
```

## Question 6

```{r}
Gender_balance <- students |> count(group,sex)
ggplot(Gender_balance, aes(x = group,y=n, fill = sex))+
      geom_col(position = "fill")
```

## Question 7

```{r}
library(lubridate)
event_date <- date(students$birth_date)
students <- students |> mutate(age=time_length(today()-event_date, unit="year"), age = as.integer(students$age)) 

students_age <- students|> distinct(id, age) |> count(age)
ggplot(students_age, aes(age, n))+
  geom_col()
```

## Question 8

```{r}
age_per_group <- students |> count(group, age) 
median_age_grp <- age_per_group |> group_by(group)|> summarise(median = median(age), median = as.integer(median_age_grp$median))
knitr::kable(median_age_grp)
```

## Question 9

```{r}
oldest <- students |> distinct(group, age) |> group_by(group) |> slice_max(age) |> arrange(desc(age))
```

## Question 10

```{r}
nb_grades = sum(!is.na(grades$grade))
glue::glue("There is {nb_grades} grades ")
```

## Question 11

```{r}
GWM_grades <- grades |> left_join(students, by = "id") |> filter(course_id==10) |> group_by(group) |> summarise(mean_grp = mean(grade, na.rm=TRUE))

ggplot(GWM_grades, aes(x=group, y=mean_grp))+
  geom_col()
```

## Question 12

```{r}
courses <- courses |> rename(course_id = identifier)
grades_sem <- grades |> left_join(courses, by = "course_id") |> count(semester, grade) 



ggplot(grades_sem, aes(grade,n))+
  geom_col()+
  facet_wrap(~semester, ncol=1)
  

```

## Question 13

```{r}
grades_per_student <- grades |> group_by(id) |> mutate(nb_grade = n()) |> left_join(students, by = "id")

knitr::kable(sample_n(grades_per_student, 5))
```



```{r}
Max_nb = max(grades_per_student$nb_grade)
Min_nb = min(grades_per_student$nb_grade)
Mean_nb = mean(grades_per_student$nb_grade)
Median_nb = median(grades_per_student$nb_grade)
```

| Name    | Value       |
|---------|-------------|
| Maximum | `Max_nb`    |
| Minimum | `Min_nb`    |
| Mean    | `Mean_nb`   |
| Median  | `Median_nb` |

## Question 14

```{r}
grades_gender <- grades_per_student |> group_by(sex) |> summarize(nb_by_gender = sum(nb_grade))

ggplot(grades_gender, aes(x=sex, y=nb_by_gender))+
  geom_col()
```

## Question 15

```{r}
Philo_logic <- grades_per_student |> filter(course_id==8) |> group_by(id) |> summarise(nb_grade_pl = sum(!is.na(grade))) |> left_join(students, by="id") |> select(-c(birth_date, age))

                                                                                  knitr::kable(sample_n(Philo_logic, 5))

```
## Question 16

```{r}
dist_philo_logic <- Philo_logic |> 
  count(nb_grade_pl, name = "n_students")

ggplot(dist_philo_logic, aes(x = nb_grade_pl, y = n_students)) +
  geom_col() 
  
```

## Question 17

```{r}
ggplot(Philo_logic, aes(x = group, y = nb_grade_pl)) +
  geom_boxplot() 

```
We can see that the boxed are almost perfectely aligned, which means tha the group have no incidence on the number of grades in the Philosophy and Logic class

## Question 18

```{r}
ggplot(Philo_logic, aes(x = group, y = nb_grade_pl, fill = sex)) +
  geom_boxplot() 

```
We can see that the boxes are still the same for the group (previous question), but they seem to slightly differ depending on the sex. There might be a correlation between both.

## Question 19

```{r}
avg_by_course <- grades |> left_join(students, by="id") |> select(-c(sex, birth_date, age)) |>
  summarise(
    avg_grade = mean(grade, na.rm = TRUE),
    .by = c(id, group, course_id)
  ) 
avg_by_course <- avg_by_course |> left_join(courses, by= "course_id") |> select (-c(course_id, semester, nb_grades))
avg_by_course <- avg_by_course |> pivot_wider(names_from = course, values_from = avg_grade)




knitr::kable(sample_n(avg_by_course), 5)
```
## Question 20

```{r}
ggplot(avg_by_course, 
       aes(x = `Xenology and Extraterrestrial Life`,
           y = `Roman History and Civilization`)) +
  geom_point()
```
## Question 21

